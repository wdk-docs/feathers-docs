

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Express &mdash; feathers docs v2019.06.21 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Socket.io" href="socketio.html" />
    <link rel="prev" title="REST transport" href="rest.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../contents.html" class="icon icon-home"> feathers docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Feathers[fɛðɚ]</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">指南</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="readme.html">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#core">核心</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#transports">传输层</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Express</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#express-app">express(app)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#express-1">express()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#app-use-path-service-mw-mw">app.use(path, service|mw|[mw])</a></li>
<li class="toctree-l4"><a class="reference internal" href="#app-listen-port">app.listen(port)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#app-setup-server">app.setup(server)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#express-rest">express.rest()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#express-notfound-options">express.notFound(options)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#express-errorhandler">express.errorHandler()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#routing">路由</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="socketio.html">Socket.io</a></li>
<li class="toctree-l3"><a class="reference internal" href="primus.html">Primus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#client">客户端</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#authentication">认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#database">数据库</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../migrating.html">Feathers v3(秃鹰)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SECURITY.html">Feathers 安全</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ecosystem/index.html">令人敬畏的Feathers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/readme.html">求助！</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/readme.html">常问问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/readme.html">特约</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">有许可证</a></li>
<li class="toctree-l1"><a class="reference internal" href="../github/index.html">github</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Summary.html">摘要</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">feathers docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">API</a> &raquo;</li>
        
      <li>Express</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/express.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="express">
<h1>Express<a class="headerlink" href="#express" title="永久链接至标题">¶</a></h1>
<p><a class="reference external" href="https://www.npmjs.com/package/&#64;feathersjs/express"><img alt="npm version" src="https://img.shields.io/npm/v/&#64;feathersjs/express.png?style=flat-square" /></a> <a class="reference external" href="https://github.com/feathersjs/feathers/blob/master/packages/express/CHANGELOG.md"><img alt="Changelog" src="https://img.shields.io/badge/changelog-.md-blue.png?style=flat-square" /></a></p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ npm install @feathersjs/express --save
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&#64;feathersjs/express</span></code> 模块包含用于Feathers的 <a class="reference external" href="http://expressjs.com/">Express</a> 框架集成:</p>
<ul class="simple">
<li><p><a class="reference external" href="#expressapp">Express框架绑定</a> 使Feathers应用程序Express兼容</p></li>
<li><p>基于Express的传输, 通过:ref:<a href="#id1"><span class="problematic" id="id2">`</span></a>api_express_rest`公开服务</p></li>
<li><p>An <a class="reference internal" href="errors.html"><span class="doc">错误</span></a></p></li>
</ul>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>This page describes how to set up an Express
server and REST API. See the <a class="reference internal" href="client/rest.html"><span class="doc">REST客户端</span></a> how to use this server on the client.</p>
</div>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>This chapter assumes that you are familiar with
<a class="reference external" href="http://expressjs.com/en/guide/routing.html">Express</a>.</p>
</div>
<div class="section" id="express-app">
<h2>express(app)<a class="headerlink" href="#express-app" title="永久链接至标题">¶</a></h2>
<p><a class="reference internal" href="application.html"><span class="doc">应用</span></a> into a fully Express (4+) compatible
application that additionally to Feathers functionality also lets you
use the <a class="reference external" href="http://expressjs.com/en/4x/api.html">Express API</a>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>

<span class="c1">// Create an app that is a Feathers AND Express application</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">());</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p><code class="docutils literal notranslate"><span class="pre">&#64;feathersjs/express</span></code> (<code class="docutils literal notranslate"><span class="pre">express</span></code>) also exposes the
standard <a class="reference external" href="http://expressjs.com/en/4x/api.html#express">Express middleware</a>:</p>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">express.json</span></code> - A JSON body parser</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">express.urlencoded</span></code> - A URL encoded form body parser</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">express.static</span></code> - To statically host files in a folder</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">express.Router</span></code> - Creates an Express router object</p></li>
</ul>
</div>
<div class="section" id="express-1">
<span id="id3"></span><h2>express()<a class="headerlink" href="#express-1" title="永久链接至标题">¶</a></h2>
<p>If no Feathers application is passed, <code class="docutils literal notranslate"><span class="pre">express()</span> <span class="pre">-&gt;</span> <span class="pre">app</span></code> returns a
plain Express application just like a normal call to Express would.</p>
</div>
<div class="section" id="app-use-path-service-mw-mw">
<h2>app.use(path, service|mw|[mw])<a class="headerlink" href="#app-use-path-service-mw-mw" title="永久链接至标题">¶</a></h2>
<p><a class="reference internal" href="services.html"><span class="doc">服务</span></a>.
an <a class="reference external" href="http://expressjs.com/en/guide/writing-middleware.html">Express middleware</a> or
an array of <a class="reference external" href="http://expressjs.com/en/guide/writing-middleware.html">Express middleware</a> on
the given path. If <a class="reference internal" href="services.html"><span class="doc">服务</span></a> is passed it
will use Feathers registration mechanism, for a middleware function
Express.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Register a service</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/todos&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span> <span class="nx">id</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Register an Express middleware</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
    <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Hello world from Express middleware&#39;</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Register multiple Express middleware functions</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/test&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="s1">&#39;Step 1 worked&#39;</span><span class="p">;</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">},</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
    <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;Hello world from Express middleware &#39;</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="app-listen-port">
<h2>app.listen(port)<a class="headerlink" href="#app-listen-port" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">app.listen(port)</span> <span class="pre">-&gt;</span> <span class="pre">HttpServer</span></code> will first call Express
<a class="reference external" href="http://expressjs.com/en/4x/api.html#app.listen">app.listen</a> and then
internally also call the <a class="reference internal" href="application.html#application-setupserver"><span class="std std-ref">.setup([server])</span></a>.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Listen on port 3030</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3030</span><span class="p">);</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;listening&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Feathers application started&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="app-setup-server">
<h2>app.setup(server)<a class="headerlink" href="#app-setup-server" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">app.setup(server)</span> <span class="pre">-&gt;</span> <span class="pre">app</span></code> is usually called internally by
<code class="docutils literal notranslate"><span class="pre">app.listen</span></code> but in the cases described below needs to be called
explicitly.</p>
<div class="section" id="sub-apps">
<h3>Sub-Apps<a class="headerlink" href="#sub-apps" title="永久链接至标题">¶</a></h3>
<p>When registering an application as a sub-app, <code class="docutils literal notranslate"><span class="pre">app.setup(server)</span></code> has
to be called to initialize the sub-apps services.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">rest</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/service&#39;</span><span class="p">,</span> <span class="nx">myService</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">mainApp</span> <span class="o">=</span> <span class="nx">express</span><span class="p">().</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api/v1&#39;</span><span class="p">,</span> <span class="nx">api</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">mainApp</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3030</span><span class="p">);</span>

<span class="c1">// Now call setup on the Feathers app with the server</span>
<span class="nx">api</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>We recommend avoiding complex sub-app setups because
websockets and Feathers built in authentication are not fully sub-app
aware at the moment.</p>
</div>
</div>
<div class="section" id="https">
<h3>HTTPS<a class="headerlink" href="#https" title="永久链接至标题">¶</a></h3>
<p>HTTPS requires creating a separate server in which case
<code class="docutils literal notranslate"><span class="pre">app.setup(server)</span></code> also has to be called explicitly.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">https</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;https&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">());</span>

<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">https</span><span class="p">.</span><span class="nx">createServer</span><span class="p">({</span>
  <span class="nx">key</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;privatekey.pem&#39;</span><span class="p">),</span>
  <span class="nx">cert</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;certificate.pem&#39;</span><span class="p">)</span>
<span class="p">},</span> <span class="nx">app</span><span class="p">).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">443</span><span class="p">);</span>

<span class="c1">// Call app.setup to initialize all services and SocketIO</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="virtual-hosts">
<h3>Virtual Hosts<a class="headerlink" href="#virtual-hosts" title="永久链接至标题">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/expressjs/vhost">vhost</a> Express middleware
can be used to run a Feathers application on a virtual host but again
requires <code class="docutils literal notranslate"><span class="pre">app.setup(server)</span></code> to be called explicitly.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">vhost</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;vhost&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/todos&#39;</span><span class="p">,</span> <span class="nx">todoService</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">host</span> <span class="o">=</span> <span class="nx">express</span><span class="p">().</span><span class="nx">use</span><span class="p">(</span><span class="nx">vhost</span><span class="p">(</span><span class="s1">&#39;foo.com&#39;</span><span class="p">,</span> <span class="nx">app</span><span class="p">));</span>
<span class="kr">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">host</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">);</span>

<span class="c1">// Here we need to call app.setup because .listen on our virtal hosted</span>
<span class="c1">// app is never called</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">setup</span><span class="p">(</span><span class="nx">server</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="express-rest">
<span id="api-express-rest"></span><h2>express.rest()<a class="headerlink" href="#express-rest" title="永久链接至标题">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">express.rest</span></code> registers a Feathers transport mechanism that allows
you to expose and consume <a class="reference internal" href="services.html"><span class="doc">服务</span></a> through a
<a class="reference external" href="https://en.wikipedia.org/wiki/Representational_state_transfer">RESTful
API</a>.
This means that you can call a service method through the <code class="docutils literal notranslate"><span class="pre">GET</span></code>,
<code class="docutils literal notranslate"><span class="pre">POST</span></code>, <code class="docutils literal notranslate"><span class="pre">PUT</span></code>, <code class="docutils literal notranslate"><span class="pre">PATCH</span></code> and <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> <a class="reference external" href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol">HTTP
methods</a>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 39%" />
<col style="width: 31%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Service method</p></th>
<th class="head"><p>HTTP method</p></th>
<th class="head"><p>Path</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>.find()</p></td>
<td><p>GET</p></td>
<td><p>/messages</p></td>
</tr>
<tr class="row-odd"><td><p>.get()</p></td>
<td><p>GET</p></td>
<td><p>/messages/1</p></td>
</tr>
<tr class="row-even"><td><p>.create()</p></td>
<td><p>POST</p></td>
<td><p>/messages</p></td>
</tr>
<tr class="row-odd"><td><p>.update()</p></td>
<td><p>PUT</p></td>
<td><p>/messages/1</p></td>
</tr>
<tr class="row-even"><td><p>.patch()</p></td>
<td><p>PATCH</p></td>
<td><p>/messages/1</p></td>
</tr>
<tr class="row-odd"><td><p>.remove()</p></td>
<td><p>DELETE</p></td>
<td><p>/messages/1</p></td>
</tr>
</tbody>
</table>
<p>要通过RESTful API公开服务, 我们必须配置``express.rest``并提供我们自己的身体解析器中间件(通常是标准的`Express 4 body-parser &lt;<a class="reference external" href="https://github.com/expressjs/body-parser">https://github.com/expressjs/body-parser</a> &gt;`_)使REST``.create``, <code class="docutils literal notranslate"><span class="pre">.update``和</span></code>.patch``调用解析HTTP正文中的数据.如果你想在* REST处理程序之前添加其他中间件*, 请在注册任何服务之前调用``app.use(middleware)``.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>身体解析器中间件必须在*任何服务之前注册*.否则, 服务方法将抛出一个``No data provided``或``’first’的第一个参数必须是一个object``错误.</p>
</div>
<div class="section" id="app-configure-express-rest">
<h3>app.configure(express.rest())<a class="headerlink" href="#app-configure-express-rest" title="永久链接至标题">¶</a></h3>
<p>使用标准格式化程序通过`res.json &lt;<a class="reference external" href="http://expressjs.com/en/4x/api.html#res.json">http://expressjs.com/en/4x/api.html#res.json</a>&gt;`_发送JSON响应来配置传输提供程序.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>

<span class="c1">// Create an Express compatible Feathers application</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">());</span>

<span class="c1">// Turn on JSON parser for REST services</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="c1">// Turn on URL-encoded parser for REST services</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="nx">extended</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}));</span>
<span class="c1">// Set up REST transport</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">rest</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="app-configure-express-rest-formatter">
<h3>app.configure(express.rest(formatter))<a class="headerlink" href="#app-configure-express-rest-formatter" title="永久链接至标题">¶</a></h3>
<p>默认的REST响应格式化程序是一个中间件, 它将服务检索的数据格式化为JSON.如果你想配置你自己的``formatter``中间件传递``formatter(req, res)``函数.这个中间件可以访问``res.data``, 它是服务返回的数据. <a href="#id1"><span class="problematic" id="id2">`</span></a>res.format &lt;<a class="reference external" href="http://expressjs.com/en/4x/api.html#res.format">http://expressjs.com/en/4x/api.html#res.format</a>&gt;`_可用于内容协商.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">());</span>

<span class="c1">// Turn on JSON parser for REST services</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
<span class="c1">// Turn on URL-encoded parser for REST services</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="nx">extended</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}));</span>
<span class="c1">// Set up REST transport</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">rest</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Format the message as text/plain</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">format</span><span class="p">({</span>
    <span class="s1">&#39;text/plain&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`The Message is: &quot;</span><span class="si">${</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">text</span><span class="si">}</span><span class="sb">&quot;`</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}))</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-service-middleware">
<h3>自定义服务中间件<a class="headerlink" href="#custom-service-middleware" title="永久链接至标题">¶</a></h3>
<p>只能在特定服务之前或之后运行的Custom Express中间件可按其应运行的顺序传递给“app.use”.:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">todoService</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span>
      <span class="nx">id</span><span class="p">,</span>
      <span class="nx">description</span><span class="o">:</span> <span class="sb">`You have to do </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">!`</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/todos&#39;</span><span class="p">,</span> <span class="nx">ensureAuthenticated</span><span class="p">,</span> <span class="nx">logRequest</span><span class="p">,</span> <span class="nx">todoService</span><span class="p">,</span> <span class="nx">updateData</span><span class="p">);</span>
</pre></div>
</div>
<p>在服务之后运行的中间件具有可用的服务调用信息</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">res.data</span></code>  - 将要发送的数据</p></li>
<li><p>:doc:服务方法调用的`./hooks`上下文</p></li>
</ul>
<p>例如``updateData``可能看起来像这样:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">updateData</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">updateData</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">next</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>如果在服务之后在自定义中间件中运行``res.send``并且不调用``next``, 则将跳过其他中间件(如REST格式化程序).这可以用于例如为某些服务方法调用呈现不同的视图.</p>
</div>
</div>
<div class="section" id="params">
<h3>params<a class="headerlink" href="#params" title="永久链接至标题">¶</a></h3>
<p>在:doc:<a href="#id1"><span class="problematic" id="id2">`</span></a>./rest`之后注册的所有中间件都可以访问``req.feathers``对象来设置服务方法``params`的属性.:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">rest</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span><span class="nx">extended</span><span class="o">:</span> <span class="kc">true</span><span class="p">}))</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">feathers</span><span class="p">.</span><span class="nx">fromMiddleware</span> <span class="o">=</span> <span class="s1">&#39;Hello world&#39;</span><span class="p">;</span>
    <span class="nx">next</span><span class="p">();</span>
  <span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/todos&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">provider</span><span class="p">);</span> <span class="c1">// -&gt; &#39;rest&#39;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">fromMiddleware</span><span class="p">);</span> <span class="c1">// -&gt; &#39;Hello world&#39;</span>

    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span>
      <span class="nx">id</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span>
      <span class="nx">description</span><span class="o">:</span> <span class="sb">`You have to do </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">!`</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3030</span><span class="p">);</span>
</pre></div>
</div>
<p>您可以通过运行示例并访问``http://localhost:3030/todos/test``来查看设置的参数.</p>
<p>避免直接设置``req.feathers = something``, 因为它可能已包含其他Feathers插件所依赖的信息.添加单个属性或使用``Object.assign(req.feathers, something)``是更可靠的选择.</p>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>由于Express中间件的顺序很重要, 任何设置服务参数的中间件都必须在*您的服务之前注册*(在`app.configure(services)``或``middleware/index.js`之前的生成应用程序中).</p>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>Although it may be convenient to set
<code class="docutils literal notranslate"><span class="pre">req.feathers.req</span> <span class="pre">=</span> <span class="pre">req;</span></code> to have access to the request object in
the service, we recommend keeping your services as provider
independent as possible. There usually is a way to pre-process your
data in a middleware so that the service does not need to know about
the HTTP request or response.</p>
</div>
</div>
<div class="section" id="params-query">
<h3>params.query<a class="headerlink" href="#params-query" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">params.query</span></code> will contain the URL query parameters sent from the
client. For the REST transport the query string is parsed using the
<a class="reference external" href="https://github.com/ljharb/qs">qs</a> module. For some query string
examples see the <a class="reference internal" href="databases/querying.html"><span class="doc">查询</span></a>
chapter.</p>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>服务器和客户端之间只传递``params.query``, 而``params``的其他部分则没有.这是出于安全原因, 因此客户端无法设置``params.user``或数据库选项.你总是可以从``params.query``映射到其他:doc:<cite>./ hooks</cite>.</p>
</div>
<p>例如:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>GET /messages?read<span class="o">=</span>true<span class="p">&amp;</span><span class="nv">$sort</span><span class="o">[</span>createdAt<span class="o">]=</span>-1
</pre></div>
</div>
<p>将``params.query``设置为</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;read&quot;</span><span class="o">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
  <span class="s2">&quot;$sort&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;-1&quot;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>由于URL只是一个字符串, 因此**将没有类型转换**.这可以在:doc:<a class="reference external" href="https://github.com/xpepermint/query-types">./hooks`中手动完成, 或者使用`query-types</a> Express中间件来转换布尔和数字类型.</p>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>如果请求中的数组包含20个以上的项, 则`qs &lt;<a class="reference external" href="https://www.npmjs.com/package/qs">https://www.npmjs.com/package/qs</a>&gt;`_ parser隐式`转换&lt;<a class="reference external" href="https://github.com/ljharb">https://github.com/ljharb</a>/qs#解析数组&gt;`_它到索引为键的对象.要扩展此限制, 您可以设置自定义查询解析器:<code class="docutils literal notranslate"><span class="pre">app.set('query</span> <span class="pre">parser',</span> <span class="pre">str</span> <span class="pre">=&gt;</span> <span class="pre">qs.parse(str,</span> <span class="pre">{arrayLimit:1000}))</span></code></p>
</div>
</div>
<div class="section" id="params-provider">
<h3><code class="docutils literal notranslate"><span class="pre">params.provider</span></code><a class="headerlink" href="#params-provider" title="永久链接至标题">¶</a></h3>
<p>对于任何:doc:<cite>./services`通过REST:doc:</cite>./hooks`这可以用来防止外部用户进行服务方法调用:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">).</span><span class="nx">hooks</span><span class="p">({</span>
  <span class="nx">before</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">remove</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// check for if(context.params.provider) to prevent any external call</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">provider</span> <span class="o">===</span> <span class="s1">&#39;rest&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;You can not delete a user via REST&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="params-route">
<h3>params.route<a class="headerlink" href="#params-route" title="永久链接至标题">¶</a></h3>
<p>请参阅`routing section &lt;#routing&gt;`_.</p>
</div>
</div>
<div class="section" id="express-notfound-options">
<h2>express.notFound(options)<a class="headerlink" href="#express-notfound-options" title="永久链接至标题">¶</a></h2>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>express.notFound()``返回返回``NotFound``(404)的中间件:doc:<cite>./errors</cite>.它应该被用作**错误处理程序之前的最后一个中间件**.可以使用以下选项:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">verbose</span></code>: 如果URL应该包含在错误消息中, 则设置为``true``(默认值:<code class="docutils literal notranslate"><span class="pre">false</span></code>)</p></li>
</ul>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Return errors that include the URL</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">notFound</span><span class="p">({</span> <span class="nx">verbose</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">errorHandler</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="express-errorhandler">
<h2>express.errorHandler()<a class="headerlink" href="#express-errorhandler" title="永久链接至标题">¶</a></h2>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>expres.errorHandler``是一个`Express错误处理程序&lt;<a class="reference external" href="https://expressjs.com/en/guide/error-handling.html">https://expressjs.com/en/guide/error-handling.html</a>&gt;`_中间件, 它将对REST调用的任何错误响应格式化为JSON(或HTML, 如果例如某人直接在浏览器中点击我们的API)并设置相应的错误代码.</p>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>你仍然可以使用任何其他Express兼容的`错误中间件&lt;<a class="reference external" href="http://expressjs.com/en/guide/error-handling.html">http://expressjs.com/en/guide/error-handling.html</a>&gt;`_ with Feathers.事实上, <a href="#id1"><span class="problematic" id="id2">``</span></a>express.errors``只是一个稍微定制的.</p>
</div>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>就像在Express中一样, 错误处理程序必须在*所有中间件和服务之后注册*.</p>
</div>
<div class="section" id="app-use-express-errorhandler">
<h3><code class="docutils literal notranslate"><span class="pre">app.use(express.errorHandler())</span></code><a class="headerlink" href="#app-use-express-errorhandler" title="永久链接至标题">¶</a></h3>
<p>使用默认配置设置错误处理程序.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">());</span>

<span class="c1">// before starting the app</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="app-use-express-errorhandler-options">
<h3><code class="docutils literal notranslate"><span class="pre">app.use(express.errorHandler(options))</span></code><a class="headerlink" href="#app-use-express-errorhandler-options" title="永久链接至标题">¶</a></h3>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">());</span>

<span class="c1">// Just like Express your error middleware needs to be</span>
<span class="c1">// set up last in your middleware chain.</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">errorHandler</span><span class="p">({</span>
    <span class="nx">html</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// render your error view with the error object</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">errorHandler</span><span class="p">({</span>
    <span class="nx">html</span><span class="o">:</span> <span class="p">{</span>
      <span class="mi">404</span><span class="o">:</span> <span class="s1">&#39;path/to/notFound.html&#39;</span><span class="p">,</span>
      <span class="mi">500</span><span class="o">:</span> <span class="s1">&#39;there/will/be/robots.html&#39;</span>
    <span class="p">}</span>
<span class="p">}));</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p>如果你想以json格式获得响应, 请确保在你的请求中将``Accept``头设置为``application/json``, 否则默认的错误处理程序将返回HTML.</p>
</div>
<p>创建新的localstorage服务时, 可以传递以下选项:</p>
<ul class="simple">
<li><p><a href="#id1"><span class="problematic" id="id2">``</span></a>html``(Function | Object)[可选]  - 自定义格式化程序函数或包含自定义html错误页面路径的对象.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">logger</span></code> (Function|false) (default: <code class="docutils literal notranslate"><span class="pre">console</span></code>) - 设置一个logger对象来记录错误(它将是带有``logger.error(error)``的记录器</p></li>
</ul>
<div class="admonition tip">
<p class="admonition-title">小技巧</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>html``也可以设置为``false``来完全禁用html错误页面, 这样只返回JSON.</p>
</div>
</div>
</div>
<div class="section" id="routing">
<h2>路由<a class="headerlink" href="#routing" title="永久链接至标题">¶</a></h2>
<p>服务URL中的快速路径占位符将添加到服务``params.route``中.</p>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>有关何时以及何时不使用嵌套路由的更多详细信息, 请参阅嵌套路由的常见问题条目&lt;../faq/readme.md＃how-do-i-do-nested-or-custom-routes&gt;`_.</p>
</div>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;@feathersjs/express&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">(</span><span class="nx">feathers</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">rest</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">feathers</span><span class="p">.</span><span class="nx">fromMiddleware</span> <span class="o">=</span> <span class="s1">&#39;Hello world&#39;</span><span class="p">;</span>
    <span class="nx">next</span><span class="p">();</span>
  <span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/users/:userId/messages&#39;</span><span class="p">,</span> <span class="p">{</span>
  <span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">query</span><span class="p">);</span> <span class="c1">// -&gt; ?query</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">provider</span><span class="p">);</span> <span class="c1">// -&gt; &#39;rest&#39;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">fromMiddleware</span><span class="p">);</span> <span class="c1">// -&gt; &#39;Hello world&#39;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">route</span><span class="p">.</span><span class="nx">userId</span><span class="p">);</span> <span class="c1">// will be `1` for GET /users/1/messages</span>

    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span>
      <span class="nx">id</span><span class="p">,</span>
      <span class="nx">params</span><span class="p">,</span>
      <span class="nx">read</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">text</span><span class="o">:</span> <span class="sb">`Feathers is great!`</span><span class="p">,</span>
      <span class="nx">createdAt</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3030</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="socketio.html" class="btn btn-neutral float-right" title="Socket.io" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rest.html" class="btn btn-neutral float-left" title="REST transport" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, BandCap

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
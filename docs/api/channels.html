

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>事件频道 &mdash; feathers docs v2019.06.21 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="错误" href="errors.html" />
    <link rel="prev" title="事件" href="events.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../contents.html" class="icon icon-home"> feathers docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Feathers[fɛðɚ]</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides/index.html">指南</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="readme.html">API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#core">核心</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="application.html">应用</a></li>
<li class="toctree-l3"><a class="reference internal" href="services.html">服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="hooks.html">钩子</a></li>
<li class="toctree-l3"><a class="reference internal" href="events.html">事件</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">事件频道</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">例如</a></li>
<li class="toctree-l4"><a class="reference internal" href="#connections">连接</a></li>
<li class="toctree-l4"><a class="reference internal" href="#app-on-logout">app.on(‘logout’)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#channels">频道</a></li>
<li class="toctree-l4"><a class="reference internal" href="#publishing">出版</a></li>
<li class="toctree-l4"><a class="reference internal" href="#keeping-channels-updated">保持频道更新</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="errors.html">错误</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.html">配置</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#transports">传输层</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#client">客户端</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#authentication">认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#database">数据库</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../migrating.html">Feathers v3(秃鹰)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SECURITY.html">Feathers 安全</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Ecosystem/index.html">令人敬畏的Feathers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/readme.html">求助！</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/readme.html">常问问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/readme.html">特约</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">有许可证</a></li>
<li class="toctree-l1"><a class="reference internal" href="../github/index.html">github</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Summary.html">摘要</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">feathers docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">API</a> &raquo;</li>
        
      <li>事件频道</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/channels.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="event-channels">
<h1>事件频道<a class="headerlink" href="#event-channels" title="永久链接至标题">¶</a></h1>
<p>在设置了实时传输(<a class="reference internal" href="primus.html"><span class="doc">Primus</span></a>)的Feathers服务器上,事件通道确定要发送的连接客户端 <a class="reference internal" href="events.html"><span class="doc">事件</span></a> to以及发送数据的外观.</p>
<p>本章介绍:</p>
<ul class="simple">
<li><p><a class="reference external" href="#connections">实时连接</a> 以及如何访问它们</p></li>
<li><p><a class="reference external" href="#channels">频道使用情况</a> 以及如何检索,加入和离开频道</p></li>
<li><p><a class="reference external" href="#publishing">发布事件</a> 到频道</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">重要</p>
<p>如果您没有使用实时传输服务器(例如,在制作仅REST API或在客户端上使用Feathers时),则通道功能将无法使用.</p>
</div>
<p>使用频道的一些示例:</p>
<ul class="simple">
<li><p>实时事件应仅发送给经过身份验证的用户</p></li>
<li><p>用户只有在加入某个聊天室时才能获得有关消息的更新</p></li>
<li><p>只有同一组织中的用户才能收到有关其数据更改的实时更新</p></li>
<li><p>创建新用户时，只应通知管理员</p></li>
<li><p>当用户被创建,修改或删除时,非管理员应该只接收用户对象的 “安全” 版本(例如,只有 <code class="docutils literal notranslate"><span class="pre">email</span></code>, <code class="docutils literal notranslate"><span class="pre">id</span></code> 和 <code class="docutils literal notranslate"><span class="pre">avatar</span></code>)</p></li>
</ul>
<div class="section" id="example">
<h2>例如<a class="headerlink" href="#example" title="永久链接至标题">¶</a></h2>
<p>下面的例子显示了生成的 <code class="docutils literal notranslate"><span class="pre">channels.js</span></code> 文件,说明了不同部分如何组合在一起:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="nx">connection</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// On a new real-time connection, add it to the</span>
    <span class="c1">// anonymous channel</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;anonymous&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
  <span class="p">});</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">{</span> <span class="nx">connection</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="c1">// connection can be undefined if there is no</span>
    <span class="c1">// real-time connection, e.g. when logging in via REST</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">user</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">;</span>

      <span class="c1">// The connection is no longer anonymous, remove it</span>
      <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;anonymous&#39;</span><span class="p">).</span><span class="nx">leave</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

      <span class="c1">// Add it to the authenticated user channel</span>
      <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;authenticated&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

      <span class="c1">// Channels can be named anything and joined on any condition</span>
      <span class="c1">// E.g. to send real-time events only to admins use</span>

      <span class="c1">// if(user.isAdmin) { app.channel(&#39;admins&#39;).join(connection); }</span>

      <span class="c1">// If the user has joined e.g. chat rooms</span>

      <span class="c1">// user.rooms.forEach(room =&gt; app.channel(`rooms/${room.id}`).join(connection))</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// A global publisher that sends all events to all authenticated clients</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">publish</span><span class="p">((</span><span class="nx">data</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;authenticated&#39;</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="connections">
<h2>连接<a class="headerlink" href="#connections" title="永久链接至标题">¶</a></h2>
<p>连接是表示实时连接的对象.它与 <code class="docutils literal notranslate"><span class="pre">socket.feathers</span></code> 中的 <code class="docutils literal notranslate"><span class="pre">socket.feathers</span></code> 在一个 <a class="reference internal" href="primus.html"><span class="doc">Primus</span></a> 中间件中与 <code class="docutils literal notranslate"><span class="pre">./socketio</span></code> 和 <code class="docutils literal notranslate"><span class="pre">socket.request.feathers</span></code> 相同.您可以向其中添加任何类型的信息,但最值得注意的是,在使用 <a class="reference internal" href="authentication/server.html"><span class="doc">认证</span></a> 时,它将包含经过身份验证的用户.默认情况下,一旦客户端在套接字上进行了身份验证(通常通过调用 <a class="reference internal" href="client.html"><span class="doc">Feathers 客户端</span></a>),它就位于 <code class="docutils literal notranslate"><span class="pre">connection.user</span></code> 中.</p>
<p>我们可以通过监听``app.on(‘connection’,connection =&gt; {})``或``app.on(‘login’,(payload,{connection})来访问``connection``对象. )=&gt; {})``.</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>当连接终止时,它将自动从所有通道中删除.</p>
</div>
<div class="section" id="app-on-connection">
<h3>app.on(‘connection’)<a class="headerlink" href="#app-on-connection" title="永久链接至标题">¶</a></h3>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>app.on(‘connection’,connection =&gt; {})``每次建立新的实时连接时都会被触发.这是为匿名用户添加通道连接的好地方(如果我们想要向他们发送任何实时更新):</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="nx">connection</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// On a new real-time connection, add it to the</span>
  <span class="c1">// anonymous channel</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;anonymous&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="app-on-login">
<h3>app.on(‘login’)<a class="headerlink" href="#app-on-login" title="永久链接至标题">¶</a></h3>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>app.on(‘login’,(payload,info)=&gt; {})``由:doc:<a href="#id3"><span class="problematic" id="id4">`</span></a>./authentication/server`发送,并且还包含``info``对象中的连接作为第二个参数传递.注意,如果通过例如登录发生登录,它也可以是“未定义的”. REST不支持实时连接.</p>
<p>这是添加与用户相关的频道的连接的好地方(例如聊天室,管理状态等)</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">{</span> <span class="nx">connection</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// connection can be undefined if there is no</span>
  <span class="c1">// real-time connection, e.g. when logging in via REST</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// The user attached to this connection</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">user</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">;</span>

    <span class="c1">// The connection is no longer anonymous, remove it</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;anonymous&#39;</span><span class="p">).</span><span class="nx">leave</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

    <span class="c1">// Add it to the authenticated user channel</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;authenticated&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

    <span class="c1">// Channels can be named anything and joined on any condition `</span>
    <span class="c1">// E.g. to send real-time events only to admins use</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">isAdmin</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// If the user has joined e.g. chat rooms</span>
    <span class="nx">user</span><span class="p">.</span><span class="nx">rooms</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">room</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="sb">`rooms/</span><span class="si">${</span><span class="nx">room</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>(user,{connection})``是``(user,meta)=&gt; {const connection = meta.connection; <a href="#id3"><span class="problematic" id="id4">``</span></a>,参见`解构赋值&lt;<a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment</a>&gt;`_.</p>
</div>
</div>
</div>
<div class="section" id="app-on-logout">
<h2>app.on(‘logout’)<a class="headerlink" href="#app-on-logout" title="永久链接至标题">¶</a></h2>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>app.on(‘logout’,(payload,info)=&gt; {})``由:doc:<a href="#id3"><span class="problematic" id="id4">`</span></a>./authentication/server`发送,并且还包含``info``对象中的连接当注销发生时,将作为第二个参数传递.</p>
<p>如果套接字在注销时也没有断开连接,则应将用户从其频道中删除:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;logout&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">{</span> <span class="nx">connection</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//When logging out, leave all channels before joining anonymous channel</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">channels</span><span class="p">).</span><span class="nx">leave</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;anonymous&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="channels">
<h2>频道<a class="headerlink" href="#channels" title="永久链接至标题">¶</a></h2>
<p>通道是包含许多连接的对象.它可以通过``app.channel``创建,并允许连接加入或离开.</p>
<div class="section" id="app-channel-names">
<h3>app.channel(…names)<a class="headerlink" href="#app-channel-names" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">app.channel(name)</span> <span class="pre">-&gt;</span> <span class="pre">Channel</span></code>, 当给出单个名称时,返回现有或新命名的通道:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">)</span> <span class="c1">// the admin channel</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;authenticated&#39;</span><span class="p">)</span> <span class="c1">// the authenticated channel</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">app.channel(name1,name2,...</span> <span class="pre">nameN)</span> <span class="pre">-</span> <span class="pre">&gt;</span> <span class="pre">Channel</span></code>,当给定多个名称时,将返回一个组合通道.组合通道包含所有连接的列表(没有重复),并重定向``channel.join``和``channel.leave``调用所有子通道.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Combine the anonymous and authenticated channel</span>
<span class="kr">const</span> <span class="nx">combinedChannel</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;anonymous&#39;</span><span class="p">,</span> <span class="s1">&#39;authenticated&#39;</span><span class="p">)</span>

<span class="c1">// Join the `anonymous` and `authenticated` channel</span>
<span class="nx">combinedChannel</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

<span class="c1">// Join the `admins` and `chat` channel</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">,</span> <span class="s1">&#39;chat&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

<span class="c1">// Leave the `admins` and `chat` channel</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">,</span> <span class="s1">&#39;chat&#39;</span><span class="p">).</span><span class="nx">leave</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

<span class="c1">// Make user with `_id` 5 leave the admins and chat channel</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">,</span> <span class="s1">&#39;chat&#39;</span><span class="p">).</span><span class="nx">leave</span><span class="p">(</span><span class="nx">connection</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="app-channels">
<h3>app.channels<a class="headerlink" href="#app-channels" title="永久链接至标题">¶</a></h3>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>app.channels  - &gt; [string]``返回所有现有频道名称的列表.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;authenticated&#39;</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">channels</span> <span class="c1">// [ &#39;authenticated&#39;, &#39;admins&#39;, &#39;users&#39; ]</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">channels</span><span class="p">)</span> <span class="c1">// will return a channel with all connections</span>
</pre></div>
</div>
<p>这对于例如从所有频道中删除连接:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// When a user is removed, make all their connections leave every channel</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;removed&#39;</span><span class="p">,</span> <span class="nx">user</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">channels</span><span class="p">).</span><span class="nx">leave</span><span class="p">(</span><span class="nx">connection</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="channel-join-connection">
<h3>channel.join(connection)<a class="headerlink" href="#channel-join-connection" title="永久链接至标题">¶</a></h3>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>channel.join(connection) - &gt; Channel``添加了一个到这个频道的连接.如果频道是组合频道,请将连接添加到其所有子频道.如果连接已经在通道中,它什么都不做.返回通道对象.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">{</span> <span class="nx">connection</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">connection</span> <span class="o">&amp;&amp;</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">isAdmin</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Join the admins channel</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>

    <span class="c1">// Calling a second time will do nothing</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="channel-leave-connection-fn">
<h3>channel.leave(connection|fn)<a class="headerlink" href="#channel-leave-connection-fn" title="永久链接至标题">¶</a></h3>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>channel.leave(connection | fn) - &gt; Channel``删除该通道的连接.如果频道是组合频道,请从其所有子频道中删除该连接.还允许传递为每个连接运行的回调,如果应该删除连接则返回.返回通道对象.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Make the user with `_id` 5 leave the `admins` channel</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">).</span><span class="nx">leave</span><span class="p">(</span><span class="nx">connection</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="channel-filter-fn">
<h3>channel.filter(fn)<a class="headerlink" href="#channel-filter-fn" title="永久链接至标题">¶</a></h3>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a>channel.filter(fn) - &gt; Channel``返回由给定函数过滤的新通道,该通道将通过连接.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Returns a new channel with all connections of the user with `_id` 5</span>
<span class="kr">const</span> <span class="nx">userFive</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">channels</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">connection</span> <span class="p">=&gt;</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="channel-send-data">
<h3>channel.send(data)<a class="headerlink" href="#channel-send-data" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">channel.send(data)</span> <span class="pre">-&gt;</span> <span class="pre">Channel</span></code> 返回此频道的副本,其中包含应为此事件发送的自定义数据.通常这应该通过修改服务方法结果或在``context.dispatch``中设置客户端“安全”数据来处理,但在某些情况下,仍然可以更改某些通道的事件数据.</p>
<p>将按照以下顺序确定的第一个数据将确定将发送哪些数据:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code> from <code class="docutils literal notranslate"><span class="pre">channel.send(data)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">context.dispatch</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">context.result</span></code></p></li>
</ol>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connection&#39;</span><span class="p">,</span> <span class="nx">connection</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// On a new real-time connection, add it to the</span>
  <span class="c1">// anonymous channel</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;anonymous&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Send the `users` `created` event to all anonymous</span>
<span class="c1">// users but use only the name as the payload</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">).</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="nx">data</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;anonymous&#39;</span><span class="p">).</span><span class="nx">send</span><span class="p">({</span>
    <span class="nx">name</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">name</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>If a connection is in multiple channels (e.g. <code class="docutils literal notranslate"><span class="pre">users</span></code> and
<code class="docutils literal notranslate"><span class="pre">admins</span></code>) it will get the data from the <em>first</em> channel that it is
in.</p>
</div>
</div>
<div class="section" id="channel-connections">
<h3>channel.connections<a class="headerlink" href="#channel-connections" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">channel.connections</span> <span class="pre">-&gt;</span> <span class="pre">[</span> <span class="pre">object</span> <span class="pre">]</span></code> 包含此频道中所有连接的列表.</p>
</div>
<div class="section" id="channel-length">
<h3>channel.length<a class="headerlink" href="#channel-length" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">channel.length</span> <span class="pre">-&gt;</span> <span class="pre">integer</span></code> 返回此通道中的连接总数.</p>
</div>
</div>
<div class="section" id="publishing">
<span id="channels-publishing"></span><h2>出版<a class="headerlink" href="#publishing" title="永久链接至标题">¶</a></h2>
<p>发布者是回调函数,用于返回将事件发送到的通道.它们可以在应用程序和服务级别以及所有或特定事件中注册.发布函数获取事件数据和上下文对象(<code class="docutils literal notranslate"><span class="pre">(data,context)=&gt;</span> <span class="pre">{}</span></code>)并返回一个命名或组合通道,一个通道数组或``null``.一种类型只能注册一个发布者.除了标准:ref:<cite>events_service-events</cite>,事件名称也可以是:ref:<cite>events_custom-events</cite>. <a href="#id1"><span class="problematic" id="id2">``</span></a>context``是来自服务调用的:doc:<a href="#id3"><span class="problematic" id="id4">`</span></a>./hooks`或包含``{path,service,app,result}``的自定义事件的对象.</p>
<div class="section" id="service-publish-event-fn">
<h3>service.publish([event,] fn)<a class="headerlink" href="#service-publish-event-fn" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">service.publish([event,]</span> <span class="pre">fn)</span> <span class="pre">-&gt;</span> <span class="pre">service</span></code> 如果没有给出事件名称,则为特定事件或所有事件注册特定服务的发布功能.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">{</span> <span class="nx">connection</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// connection can be undefined if there is no</span>
  <span class="c1">// real-time connection, e.g. when logging in via REST</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">connection</span> <span class="o">&amp;&amp;</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">isAdmin</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Publish all messages service events only to its room channel</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">).</span><span class="nx">publish</span><span class="p">((</span><span class="nx">data</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="sb">`rooms/</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">roomId</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Publish the `created` event to admins and the user that sent it</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">).</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;admins&#39;</span><span class="p">),</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">channels</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">connection</span> <span class="p">=&gt;</span>
      <span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">context</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span>
    <span class="p">)</span>
  <span class="p">];</span>
<span class="p">});</span>

<span class="c1">// Prevent all events in the `password-reset` service from being published</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;password-reset&#39;</span><span class="p">).</span><span class="nx">publish</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="kc">null</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="app-publish-event-fn">
<h3>app.publish([event,] fn)<a class="headerlink" href="#app-publish-event-fn" title="永久链接至标题">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">app.publish([event,]</span> <span class="pre">fn)</span> <span class="pre">-&gt;</span> <span class="pre">app</span></code> 如果没有给出事件名称,则为特定事件或所有事件的所有服务注册发布功能.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">{</span> <span class="nx">connection</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// connection can be undefined if there is no</span>
  <span class="c1">// real-time connection, e.g. when logging in via REST</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;authenticated&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Publish all events to all authenticated users</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">publish</span><span class="p">((</span><span class="nx">data</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;authenticated&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Publish the `log` custom event to all connections</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">publish</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">channels</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</div>
<div class="section" id="publisher-precedence">
<h3>发布者优先级<a class="headerlink" href="#publisher-precedence" title="永久链接至标题">¶</a></h3>
<p>将使用按以下顺序找到的第一个发布者回调:</p>
<ol class="arabic simple">
<li><p>特定活动的服务发布者</p></li>
<li><p>所有活动的服务发布者</p></li>
<li><p>针对特定活动的应用发布商</p></li>
<li><p>适用于所有活动的应用发布商</p></li>
</ol>
</div>
</div>
<div class="section" id="keeping-channels-updated">
<h2>保持频道更新<a class="headerlink" href="#keeping-channels-updated" title="永久链接至标题">¶</a></h2>
<p>S每个应用程序都会有所不同,保持分配给频道的连接是最新的(例如,如果用户加入/离开房间)由您决定.</p>
<p>通常,渠道应反映您的持久性应用程序数据.这意味着它通常不需要例如要求直接加入频道的用户.这在运行应用程序的多个实例时尤为重要,因为通道只是当前实例的* local <a href="#id1"><span class="problematic" id="id2">*</span></a>.</p>
<p>相反,相关信息(例如,用户当前所在的房间)应该存储在数据库中,然后可以将事件连接重新分配到适当的通道中,听取正确的:doc:<cite>./events</cite>.</p>
<p>以下示例更新或删除用户对象(假定其“room”数组是用户已加入的房间ID列表)时给定用户的所有活动连接:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// Join a channel given a user and connection</span>
<span class="kr">const</span> <span class="nx">joinChannels</span> <span class="o">=</span> <span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">connection</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;authenticated&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">);</span>
  <span class="c1">// Assuming that the chat room/user assignment is stored</span>
  <span class="c1">// on an array of the user</span>
  <span class="nx">user</span><span class="p">.</span><span class="nx">rooms</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">room</span> <span class="p">=&gt;</span>
    <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="sb">`rooms/</span><span class="si">${</span><span class="nx">roomId</span><span class="si">}</span><span class="sb">`</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Get a user to leave all channels</span>
<span class="kr">const</span> <span class="nx">leaveChannels</span> <span class="o">=</span> <span class="nx">user</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">channels</span><span class="p">).</span><span class="nx">leave</span><span class="p">(</span><span class="nx">connection</span> <span class="p">=&gt;</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Leave and re-join all channels with new user information</span>
<span class="kr">const</span> <span class="nx">updateChannels</span> <span class="o">=</span> <span class="nx">user</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Find all connections for this user</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">connections</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">channels</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">connection</span> <span class="p">=&gt;</span>
    <span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">user</span><span class="p">.</span><span class="nx">_id</span>
  <span class="p">);</span>

  <span class="c1">// Leave all channels</span>
  <span class="nx">leaveChannels</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>

  <span class="c1">// Re-join all channels with the updated user information</span>
  <span class="nx">connections</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">connection</span> <span class="p">=&gt;</span> <span class="nx">joinChannels</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">connection</span><span class="p">));</span>
<span class="p">}</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">payload</span><span class="p">,</span> <span class="p">{</span> <span class="nx">connection</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Join all channels on login</span>
    <span class="nx">joinChannels</span><span class="p">(</span><span class="nx">connection</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="nx">connection</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// On `updated` and `patched`, leave and re-join with new room assignments</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;updated&#39;</span><span class="p">,</span> <span class="nx">updateChannels</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;patched&#39;</span><span class="p">,</span> <span class="nx">updateChannels</span><span class="p">);</span>
<span class="c1">// On `removed`, remove the connection from all channels</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;removed&#39;</span><span class="p">,</span> <span class="nx">leaveChannels</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>活动连接数通常是一个(或没有),但除非您明确阻止它,否则Feathers不会阻止同一用户的多次登录(例如,有两个打开的浏览器窗口或移动设备).</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="errors.html" class="btn btn-neutral float-right" title="错误" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="events.html" class="btn btn-neutral float-left" title="事件" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, BandCap

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
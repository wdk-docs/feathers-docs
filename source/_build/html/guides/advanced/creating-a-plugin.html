

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>创建一个Feathers插件 &mdash; feathers docs v2019.06.21 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="与前端框架集成" href="../frameworks/readme.html" />
    <link rel="prev" title="缩放" href="scaling.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../contents.html" class="icon icon-home"> feathers docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Feathers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">指南</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../readme.html">指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/index.html">Feathers 基础功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chat/index.html">创建聊天应用程序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auth/index.html">身份验证指南和食谱</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">高级指南</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="readme.html">高级指南</a></li>
<li class="toctree-l3"><a class="reference internal" href="file-uploading.html">在FeathersJS中上传文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="using-a-view-engine.html">使用视图引擎</a></li>
<li class="toctree-l3"><a class="reference internal" href="scaling.html">缩放</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">创建一个Feathers插件</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#expanding-our-plugin">Expanding our Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../frameworks/readme.html">与前端框架集成</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrating.html">Feathers v3（秃鹰）</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SECURITY.html">Feathers 安全</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Ecosystem/index.html">生态系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help/readme.html">救命！</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/readme.html">常问问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/readme.html">特约</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">有许可证</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../.github/index.html">github</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Summary.html">摘要</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../contents.html">feathers docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">指南</a> &raquo;</li>
        
          <li><a href="index.html">高级指南</a> &raquo;</li>
        
      <li>创建一个Feathers插件</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/guides/advanced/creating-a-plugin.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-a-feathers-plugin">
<h1>创建一个Feathers插件<a class="headerlink" href="#creating-a-feathers-plugin" title="永久链接至标题">¶</a></h1>
<p>The easiest way to create a plugin is with the <a class="reference external" href="https://github.com/feathersjs/generator-feathers-plugin">Yeoman
generator</a>.</p>
<p>First install the generator</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">g</span> <span class="nx">generator</span><span class="o">-</span><span class="nx">feathers</span><span class="o">-</span><span class="nx">plugin</span>
</pre></div>
</div>
<p>Then in a new directory run:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">$</span> <span class="nx">yo</span> <span class="nx">feathers</span><span class="o">-</span><span class="nx">plugin</span>
</pre></div>
</div>
<p>This will scaffold out everything that is needed to start writing your
plugin.</p>
<p>Output files from generator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create</span> <span class="n">package</span><span class="o">.</span><span class="n">json</span>
<span class="n">create</span> <span class="o">.</span><span class="n">babelrc</span>
<span class="n">create</span> <span class="o">.</span><span class="n">editorconfig</span>
<span class="n">create</span> <span class="o">.</span><span class="n">jshintrc</span>
<span class="n">create</span> <span class="o">.</span><span class="n">travis</span><span class="o">.</span><span class="n">yml</span>
<span class="n">create</span> <span class="n">src</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">js</span>
<span class="n">create</span> <span class="n">test</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">js</span>
<span class="n">create</span> <span class="n">README</span><span class="o">.</span><span class="n">md</span>
<span class="n">create</span> <span class="n">LICENSE</span>
<span class="n">create</span> <span class="o">.</span><span class="n">gitignore</span>
<span class="n">create</span> <span class="o">.</span><span class="n">npmignore</span>
</pre></div>
</div>
<p>Simple right? We technically could call it a day as we have created a
Plugin. However, we probably want to do just a bit more. Generally
speaking a Plugin is a <span class="xref std std-doc">../api/services</span>. The fun part
is that a Plugin can contain multiple Services which we will create
below. This example is going to build out 2 services. The first will
allow us to find members of the Feathers Core Team &amp; the second will
allow us to find the best state in the United States.</p>
<p>##Verifying our Service</p>
<p>Before we start writing more code we need to see that things are
working.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd example &amp;&amp; node app.js

Error: Cannot find module &#39;../lib/index&#39;
</pre></div>
</div>
<p>Dang! Running the example app resulted in an error and you said to
yourself, “The generator must be broken and we should head over to the
friendly Slack community to start our debugging journey”. Well, as nice
as they may be we can get through this. Let’s take a look at the
package.json that came with our generator. Most notably the scripts
section.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;prepublish&quot;</span><span class="o">:</span> <span class="s2">&quot;npm run compile&quot;</span><span class="p">,</span>
    <span class="s2">&quot;publish&quot;</span><span class="o">:</span> <span class="s2">&quot;git push origin &amp;&amp; git push origin --tags&quot;</span><span class="p">,</span>
    <span class="s2">&quot;release:patch&quot;</span><span class="o">:</span> <span class="s2">&quot;npm version patch &amp;&amp; npm publish&quot;</span><span class="p">,</span>
    <span class="s2">&quot;release:minor&quot;</span><span class="o">:</span> <span class="s2">&quot;npm version minor &amp;&amp; npm publish&quot;</span><span class="p">,</span>
    <span class="s2">&quot;release:major&quot;</span><span class="o">:</span> <span class="s2">&quot;npm version major &amp;&amp; npm publish&quot;</span><span class="p">,</span>
    <span class="s2">&quot;compile&quot;</span><span class="o">:</span> <span class="s2">&quot;rimraf lib/ &amp;&amp; babel -d lib/ src/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;watch&quot;</span><span class="o">:</span> <span class="s2">&quot;babel --watch -d lib/ src/&quot;</span><span class="p">,</span>
    <span class="s2">&quot;jshint&quot;</span><span class="o">:</span> <span class="s2">&quot;jshint src/. test/. --config&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mocha&quot;</span><span class="o">:</span> <span class="s2">&quot;mocha --recursive test/ --compilers js:babel-core/register&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="s2">&quot;npm run compile &amp;&amp; npm run jshint &amp;&amp; npm run mocha&quot;</span><span class="p">,</span>
    <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;npm run compile &amp;&amp; node example/app&quot;</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Back in business. That error message was telling us that we need to
build our project. In this case it means babel needs to do it’s thing.
For development you can run watch</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm run watch

&gt; creatingPlugin@0.0.0 watch /Users/ajones/git/training/creatingPlugin
&gt; babel --watch -d lib/ src/

src/index.js -&gt; lib/index.js
</pre></div>
</div>
<p>After that you can run the example app and everything should be good to
go.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ node app.js
Feathers app started on 127.0.0.1:3030
</pre></div>
</div>
<div class="section" id="expanding-our-plugin">
<h2>Expanding our Plugin<a class="headerlink" href="#expanding-our-plugin" title="永久链接至标题">¶</a></h2>
<p>Now that we did our verification we can safely change things. For this
example we want 2 services to be exposed from our Plugin. Let’s create a
services directory within the src folder.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">// From the src directory</span>
<span class="nx">$</span> <span class="nx">mkdir</span> <span class="nx">services</span>
<span class="nx">$</span> <span class="nx">ls</span>
<span class="nx">index</span><span class="p">.</span><span class="nx">js</span> <span class="nx">services</span>
</pre></div>
</div>
<p>Now let’s create our two services. We will just copy the index.js file.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="nx">$</span> <span class="nx">cp</span> <span class="nx">index</span><span class="p">.</span><span class="nx">js</span> <span class="nx">services</span><span class="o">/</span><span class="nx">core</span><span class="o">-</span><span class="nx">team</span><span class="p">.</span><span class="nx">js</span>
<span class="nx">$</span> <span class="nx">cp</span> <span class="nx">index</span><span class="p">.</span><span class="nx">js</span> <span class="nx">services</span><span class="o">/</span><span class="nx">best</span><span class="o">-</span><span class="nx">state</span><span class="p">.</span><span class="nx">js</span>
<span class="nx">$</span> <span class="nx">cd</span> <span class="nx">services</span> <span class="o">&amp;&amp;</span> <span class="nx">ls</span>
<span class="nx">best</span><span class="o">-</span><span class="nx">state</span><span class="p">.</span><span class="nx">js</span> <span class="nx">core</span><span class="o">-</span><span class="nx">team</span><span class="p">.</span><span class="nx">js</span>

<span class="nx">$</span> <span class="nx">cat</span> <span class="nx">best</span><span class="o">-</span><span class="nx">state</span><span class="p">.</span><span class="nx">js</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">global</span><span class="p">.</span><span class="nx">_babelPolyfill</span><span class="p">)</span> <span class="p">{</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;babel-polyfill&#39;</span><span class="p">);</span> <span class="p">}</span>

<span class="kr">import</span> <span class="nx">errors</span> <span class="nx">from</span> <span class="s1">&#39;feathers-errors&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">makeDebug</span> <span class="nx">from</span> <span class="s1">&#39;debug&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">debug</span> <span class="o">=</span> <span class="nx">makeDebug</span><span class="p">(</span><span class="s1">&#39;creatingPlugin&#39;</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">Service</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">find</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Put some async code here.</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">params</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">BadRequest</span><span class="p">());</span>
      <span class="p">}</span>

      <span class="nx">resolve</span><span class="p">([]);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;Initializing creatingPlugin plugin&#39;</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">init</span><span class="p">.</span><span class="nx">Service</span> <span class="o">=</span> <span class="nx">Service</span><span class="p">;</span>
</pre></div>
</div>
<p>At this point we have index.js, best-state.js and core-team.js with
identical content. The next step will be to change index.js so that it
is our main file.</p>
<p>Our new index.js</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">global</span><span class="p">.</span><span class="nx">_babelPolyfill</span><span class="p">)</span> <span class="p">{</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;babel-polyfill&#39;</span><span class="p">);</span> <span class="p">}</span>

<span class="kr">import</span> <span class="nx">coreTeam</span> <span class="nx">from</span> <span class="s1">&#39;./services/core-team&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">bestState</span> <span class="nx">from</span> <span class="s1">&#39;./services/best-state&#39;</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="p">{</span> <span class="nx">coreTeam</span><span class="p">,</span> <span class="nx">bestState</span> <span class="p">};</span>
</pre></div>
</div>
<p>Now we need to actually write the services. We will only be implementing
the find action as you can reference the <a class="reference internal" href="../../api/services.html"><span class="doc">service docs</span></a> to learn more. Starting with
core-team.js we want to find out the names of the members listed in the
feathers.js org on github.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">//core-team.js</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">global</span><span class="p">.</span><span class="nx">_babelPolyfill</span><span class="p">)</span> <span class="p">{</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;babel-polyfill&#39;</span><span class="p">);</span> <span class="p">}</span>

<span class="kr">import</span> <span class="nx">errors</span> <span class="nx">from</span> <span class="s1">&#39;feathers-errors&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">makeDebug</span> <span class="nx">from</span> <span class="s1">&#39;debug&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">debug</span> <span class="o">=</span> <span class="nx">makeDebug</span><span class="p">(</span><span class="s1">&#39;creatingPlugin&#39;</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">Service</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">//We are only changing the find...</span>
  <span class="nx">find</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="s1">&#39;Mikey&#39;</span><span class="p">,</span> <span class="s1">&#39;Cory Smith&#39;</span><span class="p">,</span> <span class="s1">&#39;David Luecke&#39;</span><span class="p">,</span> <span class="s1">&#39;Emmanuel Bourmalo&#39;</span><span class="p">,</span> <span class="s1">&#39;Eric Kryski&#39;</span><span class="p">,</span>
      <span class="s1">&#39;Glavin Wiechert&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack Guy&#39;</span><span class="p">,</span> <span class="s1">&#39;Anton Kulakov&#39;</span><span class="p">,</span> <span class="s1">&#39;Marshall Thompson&#39;</span><span class="p">])</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;Initializing creatingPlugin plugin&#39;</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">init</span><span class="p">.</span><span class="nx">Service</span> <span class="o">=</span> <span class="nx">Service</span><span class="p">;</span>
</pre></div>
</div>
<p>That will now return an array of names when service.find is called.
Moving on to the best-state service we can follow the same pattern</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">global</span><span class="p">.</span><span class="nx">_babelPolyfill</span><span class="p">)</span> <span class="p">{</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;babel-polyfill&#39;</span><span class="p">);</span> <span class="p">}</span>

<span class="kr">import</span> <span class="nx">errors</span> <span class="nx">from</span> <span class="s1">&#39;feathers-errors&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">makeDebug</span> <span class="nx">from</span> <span class="s1">&#39;debug&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">debug</span> <span class="o">=</span> <span class="nx">makeDebug</span><span class="p">(</span><span class="s1">&#39;creatingPlugin&#39;</span><span class="p">);</span>

<span class="kr">class</span> <span class="nx">Service</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">find</span><span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="s1">&#39;Alaska&#39;</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;Initializing creatingPlugin plugin&#39;</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Service</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">init</span><span class="p">.</span><span class="nx">Service</span> <span class="o">=</span> <span class="nx">Service</span><span class="p">;</span>
</pre></div>
</div>
<p>Notice in the above service it return a single item array with the best
state listed.</p>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="永久链接至标题">¶</a></h2>
<p>The easiest way to use our plugin will be within the same app.js file
that we were using earlier. Let’s write out some basic usage in that
file.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="c1">//app.js</span>
<span class="kr">const</span> <span class="nx">feathers</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;feathers&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">rest</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;feathers-rest&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">hooks</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;feathers-hooks&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">errorHandler</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;feathers-errors/handler&#39;</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">plugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../lib/index&#39;</span><span class="p">);</span>

<span class="c1">// Initialize the application</span>
<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">feathers</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">rest</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">hooks</span><span class="p">())</span>
  <span class="c1">// Needed for parsing bodies (login)</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nx">urlencoded</span><span class="p">({</span> <span class="nx">extended</span><span class="o">:</span> <span class="kc">true</span> <span class="p">}))</span>
  <span class="c1">// Initialize your feathers plugin</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/plugin/coreTeam&#39;</span><span class="p">,</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">coreTeam</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/plugin/bestState&#39;</span><span class="p">,</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">bestState</span><span class="p">())</span>
  <span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">errorHandler</span><span class="p">());</span>


<span class="kd">var</span> <span class="nx">bestStateService</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;/plugin/bestState&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">coreTeamService</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;/plugin/coreTeam&#39;</span><span class="p">)</span>

<span class="nx">bestStateService</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span> <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error finding the best state &#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">coreTeamService</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span> <span class="nx">error</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error finding the core team &#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3030</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Feathers app started on 127.0.0.1:3030&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ node app.js

Feathers app started on 127.0.0.1:3030
[ &#39;Alaska&#39; ]
[ &#39;Mikey&#39;,
  &#39;Cory Smith&#39;,
  &#39;David Luecke&#39;,
  &#39;Emmanuel Bourmalo&#39;,
  &#39;Eric Kryski&#39;,
  &#39;Glavin Wiechert&#39;,
  &#39;Jack Guy&#39;,
  &#39;Anton Kulakov&#39;,
  &#39;Marshall Thompson&#39; ]
</pre></div>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="永久链接至标题">¶</a></h2>
<p>Our generator stubbed out some basic tests. We will remove everything
and replace it with the following.</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">expect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;chai&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">plugin</span> <span class="nx">from</span> <span class="s1">&#39;../src&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">bestStateService</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">bestState</span><span class="p">()</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;bestState&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;is Alaska&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="nx">bestStateService</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
      <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eql</span><span class="p">([</span><span class="s1">&#39;Alaska&#39;</span><span class="p">]);</span>
      <span class="nx">done</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm run test
</pre></div>
</div>
<p>Because this is just a quick sample jshint might fail. You can either
fix the syntax or change the test command.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ npm run compile &amp;&amp; npm run mocha
</pre></div>
</div>
<p>This should give you the basic idea of creating a Plugin for Feathers.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../frameworks/readme.html" class="btn btn-neutral float-right" title="与前端框架集成" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="scaling.html" class="btn btn-neutral float-left" title="缩放" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, BandCap

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>